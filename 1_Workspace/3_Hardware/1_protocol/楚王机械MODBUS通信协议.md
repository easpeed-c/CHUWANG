# 楚王机械MODBUS通信协议

## 硬件选择
- 定昌3568安卓板
- 7寸标准模组
- 通信接口：RS232

## 软件接口
- 通信协议：RS232 ASCII master,PLC设备作为从机使用
- 通讯数据结构：`9600bps`，`7bit数据`，`Even`，`1起始位`，`1停止位`
- 数据通信格式：`:` `01` `CMD` `ADDRH` `ADDRL` `DATAH` `DATAL` `LRC CHK` `CR LF`
  - `:` : 起始字符
  - `01` : 从站地址
  - `CMD` : 命令码
  - `ADDRH` : 通信地址高字节
  - `ADDRL` : 通信地址低字节
  - `DATAH` : 数据地址低字节
  - `DATAL` : 数据地址低字节
  - `LRC CHK` : LRC校验码
  - `CR LF` : 结束字符，Java环境中使用 __`\r\n`__ 来实现
- LRC校验码计算方法：~(`0x01` + `CMD` + `ADDRH` + `ADDRH` + `DATAH` + `DATAL`)+1

## 命令码功能
- `02` : 读节点状态
- `05` : 写单独节点状态
- `03` : 读寄存器的内容值
- `06` : 写单独寄存器的内容值

## 通信地址(`ADDRH` + `ADDRL`)
### 节点类型
- 读写操作分别使用命令码: `02` , `05`
- `PLC状态` : `085E`
### 寄存器类型
- 读写操作分别使用命令码: `03` , `06`
- `长度设定` : `11C6`
- `频率设定` : `11AA`
- `脉冲系数` : `11CA`
- `加减速` : `11A2`
- `实时频率` : `1002`

## 读取PLC状态指令(`ASCII码` + `LRC CHK` + `CR LF`)
### 节点类型
- 读取PLC状态： `:0102085E0001` + `96` + `CR LF`
  - 开机状态响应： `:0102015F9D` + `CR LF`
  - 关机状态响应： `:0102015E9E` + `CR LF`
### 寄存器类型
- 读取长度设定值： `:010311C60001` + `24` + `CR LF`
- 读取频率设定值： `:010311AA0001` + `40` + `CR LF`
- 读取脉冲系数值： `:010311CA0001` + `20` + `CR LF`
- 读取加减速值： `:010311A20001` + `48` + `CR LF`
- 读取实时频率值： `:010310020001` + `E9` + `CR LF`
- 从机响应数据格式：`:010302` + `DATA + `CR LF`
  - `DATA` = `DATAH` + `DATAL`

## 写PLC操作指令(`ASCII码` + `LRC CHK` + `CR LF`)
### 节点类型
- PLC状态写为开机： `:0105085E0001` + `95` + `CR LF`
- PLC状态写为关机： `:0105085E0000` + `94` + `CR LF`
- 从机响应：原发送数据
### 寄存器类型
- 读取长度设定值： `:010611C6` + `DATA` + `LRC CHK` + `CR LF`
- 读取频率设定值： `:010611AA` + `DATA` + `LRC CHK` + `CR LF`
- 读取脉冲系数值： `:010611CA` + `DATA` + `LRC CHK` + `CR LF`
- 读取加减速值： `:010611A2` + `DATA` + `LRC CHK` + `CR LF`
- 读取实时频率值： `:01031002` + `DATA` + `LRC CHK` + `CR LF`
  - `DATA` = `DATAH` + `DATAL`
- 从机响应：原发送数据
